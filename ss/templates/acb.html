{% extends 'layout.html' %}

{% block title %}ACB Dashboard{% endblock %}

{% block content %}
<h2>ACB Data (NIFTY)</h2>

<!-- Stats Cards -->
<div class="stats mb-3">
    <div class="stat-card">
        <div class="stat-label">Max Strike</div>
        <div class="stat-value" id="max-strike">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Call LTP</div>
        <div class="stat-value" id="call-ltp">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Put LTP</div>
        <div class="stat-value" id="put-ltp">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Range Up</div>
        <div class="stat-value" id="range-up">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Range Down</div>
        <div class="stat-value" id="range-down">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Range</div>
        <div class="stat-value" id="range-val">0</div>
    </div>
</div>

<!-- Refresh Button -->
<button class="refresh-btn" onclick="fetchACBData()">ðŸ”„ Refresh Data</button>

<!-- Table -->
<table>
    <thead>
        <tr>
            <th>Strike</th>
            <th>Option</th>
            <th>Open</th>
            <th>High</th>
            <th>LTP</th>
            <th>Low</th>
            <th>Close</th>
            <th>Volume</th>
            <th>Value</th>
            <th>OpenInterest</th>
            <th>IV</th>
        </tr>
    </thead>
    <tbody id="acb-table">
        <tr><td colspan="11" class="text-center">Loading data...</td></tr>
    </tbody>
</table>

<div class="record-count" id="record-count"></div>

<!-- Green bold for first 6 rows -->
<style>
#acb-table tr:nth-child(-n+6) {
    border: 2px solid #10b981; /* green border */
    font-weight: bold;
}
</style>

<script>
async function fetchACBData() {
    try {
        const response = await fetch('/api/acb/');
        const data = await response.json();

        if (data.error) {
            document.getElementById('acb-table').innerHTML = `<tr><td colspan="11" class="text-center text-danger">${data.error}</td></tr>`;
            return;
        }

        // Update Stats Cards
        document.getElementById('max-strike').textContent = data.max_strike;
        document.getElementById('call-ltp').textContent = data.call_ltp;
        document.getElementById('put-ltp').textContent = data.put_ltp;
        document.getElementById('range-up').textContent = data.rangeUp;
        document.getElementById('range-down').textContent = data.rangeDown;
        document.getElementById('range-val').textContent = data.range;

        // Fill Table
        const tbody = document.getElementById('acb-table');
        tbody.innerHTML = '';
        data.data.forEach(row => {
            tbody.innerHTML += `
                <tr>
                    <td>${row.Strike}</td>
                    <td>${row.Option}</td>
                    <td>${row.Open}</td>
                    <td>${row.High}</td>
                    <td>${row.LTP}</td>
                    <td>${row.Low}</td>
                    <td>${row.Close}</td>
                    <td>${row.Volume}</td>
                    <td>${row.Value}</td>
                    <td>${row.OpenInterest}</td>
                    <td>${row.IV}</td>
                </tr>
            `;
        });

        // Record count
        document.getElementById('record-count').textContent = `Showing ${data.records} records`;

    } catch (err) {
        document.getElementById('acb-table').innerHTML = `<tr><td colspan="11" class="text-center text-danger">Error fetching data</td></tr>`;
        console.error(err);
    }
}

// Fetch data on page load
fetchACBData();
</script>
{% endblock %}