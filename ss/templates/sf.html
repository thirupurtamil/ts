{% extends 'layout.html' %}
{% block title %}Synthetic Future Tracker{% endblock %}
{% block content %}
<!-- ‡Æâ‡Æ©‡Øç CSS design Í∑∏ÎåÄÎ°ú ‡Æµ‡Øà‡Æ§‡Øç‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç -->

<div class="container py-4 fade-in">
  <div class="page-header mb-4 shadow-sm">
    <h2>üìä Synthetic Future Tracker</h2>
    <div id="timestamp" class="timestamp">Loading...</div>
  </div>

  <div id="closest-card"></div>
  <div id="table-section"></div>

  <div class="text-center mt-3">
    <button class="btn btn-primary" onclick="loadSF()">üîÑ Refresh</button>
  </div>

  <footer class="text-center">
    Made with ‚ù§Ô∏è by <b>Tamil</b> ‚Äî Synthetic Future Dashboard ‚ú®
  </footer>
</div>

<script>
async function loadSF() {
  const timestamp = document.getElementById('timestamp');
  const card = document.getElementById('closest-card');
  const table = document.getElementById('table-section');

  timestamp.innerHTML = "Fetching data... ‚è≥";
  card.innerHTML = "";
  table.innerHTML = "";

  try {
    const res = await fetch("/api/sf/");
    const data = await res.json();

    if (data.message) {
      card.innerHTML = `<div class="alert alert-warning text-center">${data.message}</div>`;
      return;
    }

    timestamp.innerHTML = `SF: <b>${data.closest.Synthetic_Future}</b> | Time: <b>${data.timestamp}</b>`;

    card.innerHTML = `
      <div class="card info-card border-start border-4 border-primary mb-4">
        <div class="card-body">
          <h5 class="mb-3 text-primary fw-bold">
            üéØ C_P: ${data.closest.Strike} | C_ATM: ${data.closest.Added_Premium}
          </h5>
          <div class="row text-center">
            <div class="col"><b>CALL</b><br><span class="highlight-value">‚Çπ${data.closest.Call}</span></div>
            <div class="col"><b>PUT</b><br><span class="highlight-value">‚Çπ${data.closest.Put}</span></div>
            <div class="col"><b>DIFF</b><br>
              <span class="badge ${data.closest.Diff >= 0 ? 'bg-success' : 'bg-danger'} badge-custom">
                ${data.closest.Diff >= 0 ? '+' : ''}${data.closest.Diff}
              </span>
            </div>
          </div>
          <hr>
          <div class="d-flex justify-content-around small text-muted">
            <div>R1: <b>${data.closest.res1}</b></div>
            <div>R2: <b>${data.closest.res2}</b></div>
            <div>S1: <b>${data.closest.sup1}</b></div>
            <div>S2: <b>${data.closest.sup2}</b></div>
          </div>
        </div>
      </div>
    `;

    table.innerHTML = `
      <div class="card info-card">
        <div class="card-body">
          <h5 class="mb-3 text-primary fw-bold">üìà All Synthetic Future Data</h5>
          <div class="table-responsive">
            <table class="table table-striped table-hover text-center align-middle">
              <thead>
                <tr>
                  <th>Strike</th>
                  <th>Call LTP</th>
                  <th>Put LTP</th>
                  <th>Diff</th>
                  <th>Synthetic Future</th>
                </tr>
              </thead>
              <tbody>
                ${data.synthetic.map(r => `
                  <tr ${r.Strike === data.closest.Strike ? 'class="table-info"' : ''}>
                    <td><b>${r.Strike}</b></td>
                    <td>‚Çπ${r.Call}</td>
                    <td>‚Çπ${r.Put}</td>
                    <td class="${r.Diff >= 0 ? 'text-success' : 'text-danger'} fw-semibold">
                      ${r.Diff >= 0 ? '+' : ''}${r.Diff}
                    </td>
                    <td><b>${r.Synthetic_Future}</b></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    `;
  } catch (error) {
    card.innerHTML = `<div class="alert alert-danger text-center">‚ö†Ô∏è Error loading data!</div>`;
  }
}

loadSF();
</script>
{% endblock %}